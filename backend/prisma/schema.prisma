// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

model Users {
  id        Int @id @default(autoincrement())
  login     String @unique
  email     String @unique
  password  String
  phone     String?
  highlights Highlights[]
  collections Collections[]
  words     Words[]
  tests     Tests[]
  achievements AchievementsOnUsers[]
  language  String
  theme     String
  books     Books[] @relation("bookOwner")
}

model Books {
  id        Int @id @default(autoincrement())
  title     String
  author    String?
  document  String
  image     String?
  highlights Highlights[]
  collections BooksOnCollections[]
  uploaded  String
  user      Users @relation("bookOwner", fields: [userid], references: [id]) 
  userid    Int   
}

model Achievements {
  id               Int @id @default(autoincrement())
  name             String @unique
  description      String
  users            AchievementsOnUsers[]
}

model Positions {
  id            Int @id @default(autoincrement())
  page          Int?
  line          Int?
  symbol        Int?
  coordinateX Int?
  coordinateY Int?
  highlightsfrom Highlights[] @relation("positionsOnHighlightsFrom")
  highlightsto Highlights[] @relation("positionsOnHighlightsTo")
}

model Collections {
  id              Int @id @default(autoincrement())
  title           String
  user            Users @relation(fields: [userid], references: [id]) 
  userid          Int
  books           BooksOnCollections[]
  tests           TestsOnCollections[]
}

model Highlights {
  id             Int @id @default(autoincrement())
  book           Books @relation(fields: [bookid], references: [id])
  bookid         Int
  user           Users @relation(fields: [userid], references: [id])
  userid         Int
  from           Positions @relation("positionsOnHighlightsFrom", fields: [fromid], references: [id])
  fromid         Int
  to             Positions @relation("positionsOnHighlightsTo", fields: [toid], references: [id])
  toid           Int
  title          String
  text           String
  color          String
}

model Words {
  id Int    @id @default(autoincrement())
  color     String
  word      String
  description String
  translation String
  user      Users @relation(fields: [userid], references: [id])
  userid    Int
  test      Tests @relation(fields: [testid], references: [id])
  testid    Int
}

model Tests {
  id        Int @id @default(autoincrement())
  title     String
  prompt    String
  language  String
  difficulty String
  user      Users @relation(fields: [userid], references: [id])
  userid    Int
  questions Questions[]
  collections TestsOnCollections[]
  words     Words[]
}

model Questions {
  id            Int @id @default(autoincrement())
  test          Tests @relation(fields: [testid], references: [id])
  testid        Int
  number        Int
  questionText  String
  type          String
  answers       String?
  correct       String
  explanation   String?
}

model AchievementsOnUsers {
  user                    Users @relation(fields: [userid], references: [id])
  userid                  Int
  achievement             Achievements @relation(fields: [achievementid], references: [id])
  achievementid           Int

  @@id([userid, achievementid])
}

model BooksOnCollections {
  book                   Books @relation(fields: [bookid], references: [id])
  bookid                 Int
  collection             Collections @relation(fields: [collectionid], references: [id])
  collectionid           Int
  position               Int
  @@id([bookid, collectionid])
}

model TestsOnCollections {
  test                   Tests @relation(fields: [testid], references: [id])
  testid                 Int
  collection             Collections @relation(fields: [collectionid], references: [id])
  collectionid           Int

  @@id([testid, collectionid])
}